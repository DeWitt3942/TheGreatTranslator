videojs.plugin("resolutions",function(){var e=this;vjs.reduce=function(e,t,s){if(e&&0!==e.length){for(var o=0,i=e.length;o<i;o++)s=t.call(e,s,e[o],o);return s}},this.resolutions_={options_:{},stopStream:function(){switch(e.techName){case"Html5":break;case"Flash":e.tech.el_.vjs_stop()}e.src("")},removeSources:function(){var t=e.el_.getElementsByTagName("video")[0];if("Html5"===e.techName&&t)for(var s=t.getElementsByTagName("source"),o=0;o<s.length;o++)t.removeChild(s[o])},bucketByTypes:function(t){return vjs.reduce(t,function(e,t){return(e[t.type]=e[t.type]||[]).push(t),e},{},e)},selectSource:function(e){this.removeSources();var t=this.bucketByTypes(e),s=this.selectTypeAndTech(e);return!!s&&(this.options_.sourceResolutions=t[s.type],this.selectResolution(this.options_.sourceResolutions))},selectTypeAndTech:function(t){for(var s,o,i=0,n=e.options_.techOrder;i<n.length;i++)if(s=videojs.capitalize(n[i]),o=window.videojs[s],o.isSupported())for(var r=0,u=t;r<u.length;r++){var c=u[r];if(o.canPlaySource(c))return{type:c.type,tech:s}}},selectResolution:function(t){var s=0,o=!!window.localStorage;videojs.obj.each(t,function(e,t){t.index=parseInt(e,10),t["data-default"]&&(s=t.index)},e);var i=s;if(o){var n=parseInt(window.localStorage.getItem("videojs_preferred_res"),10);isNaN(n)||(i=n)}var r=t.length-1;return t[i>r?r:i]}},e.resolution=function(){return this.cache_.src.res},e.changeResolution=function(e){if(this.cache_.src===e.src)return this.trigger("resolutionchange"),this;var t=this.currentTime(),s=this.paused();this.pause(),this.resolutions_.stopStream(),"Html5"===this.techName?this.src(e.src):this.loadTech(this.techName,{src:e.src}),this.ready(function(){this.one("loadeddata",vjs.bind(this,function(){this.currentTime(t)})),this.trigger("resolutionchange"),s||(this.load(),this.play()),vjs.setLocalStorage("videojs_preferred_res",parseInt(e.index,10))})};var t=videojs.MenuItem.extend({init:function(e,t){t.label=t.source["data-res"],videojs.MenuItem.call(this,e,t),this.source=t.source,this.resolution=t.source["data-res"],this.player_.one("loadstart",vjs.bind(this,this.update)),this.player_.on("resolutionchange",vjs.bind(this,this.update))}});t.prototype.onClick=function(){videojs.MenuItem.prototype.onClick.call(this),this.player_.changeResolution(this.source)},t.prototype.update=function(){this.player_.cache_.src===this.source.src?this.selected(!0):this.selected(!1)};var s=videojs.MenuButton.extend({init:function(e,t){videojs.MenuButton.call(this,e,t),this.items.length<=1&&this.hide()}});s.prototype.sourceResolutions_,s.prototype.sourceResolutions=function(){return this.sourceResolutions_},s.prototype.onClick=function(e){if(e.target.className.match(/vjs-control-content/))this[this.el_.className.match(/touched/)?"removeClass":"addClass"]("touched");else{for(var t=document.getElementsByClassName("vjs-menu-button"),s=0;s<t.length;s++)videojs.removeClass(t[s],"touched");this.removeClass("touched")}},s.prototype.createItems=function(){for(var e=this.sourceResolutions_=this.player_.resolutions_.options_.sourceResolutions,s=[],o=0;o<e.length;o++)s.push(new t(this.player_,{source:this.sourceResolutions_[o]}));return s},ResolutionsButton=s.extend({init:function(e,t,o){s.call(this,e,t,o),this.el_.setAttribute("aria-label","Resolutions Menu"),this.el_.setAttribute("id","vjs-resolutions-button")}}),ResolutionsButton.prototype.kind_="resolutions",ResolutionsButton.prototype.buttonText="Resolutions",ResolutionsButton.prototype.className="vjs-resolutions-button",videojs.obj.merge(e.controlBar.options_.children,{resolutionsButton:{}});var o=e.resolutions_.selectSource(e.options_.sources);e.ready(function(){e.changeResolution(o);var t=new ResolutionsButton(e);e.controlBar.addChild(t)})});